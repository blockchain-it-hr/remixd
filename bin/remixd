#!/usr/bin/env node
const origins = require('../public/origins.json');

//Commander part
const program = require('commander');
const dotenv = require('dotenv');
const path = require('path');

let options = {};
const fullPath = path.resolve(process.cwd(), `.env`);
console.log(fullPath);
options.path = fullPath
dotenv.config(options);

program
    .usage('[options]')
    .description('Provide a two-way connection between the local computer and Remix IDE')
    .option('--remix-ide  <url>', 'URL of remix instance allowed to connect to this web socket connection', 'https://remix.ethereum.org')
    .option('-s, --shared-folder <path>', 'Folder to share with Remix IDE')
    .option('--read-only', 'Treat shared folder as read-only (experimental)')
    .option('--forward-commands', 'Enables CLI commands forwarding')
    .option('--permissions <path>', 'What permissions are allowed')
    .on('--help', function () {
        console.log('\nExample:\n\n    remixd -s ./ --remix-ide http://localhost:8080\n')
    }).parse(process.argv)

if (program.sharedFolder) {
    process.env.SHARED_FOLDER = program.sharedFolder;
    console.log('\x1b[33m%s\x1b[0m', '[WARN] Any application that runs on your computer can potentially read from and write to all files in the directory.');
    console.log('\x1b[33m%s\x1b[0m', '[WARN] Symbolic links are not forwarded to Remix IDE\n')
}


if (program.readOnly) {
    process.env.READ_ONLY = true;
}

if (program.remixIde) {
    origins.push(program.remixIde);
}

if (program.permissions) {
    process.env.PERMISSIONS = program.permissions;
}

if (program.port) {

}

process.env.ORIGINS = origins;
console.log('\x1b[33m%s\x1b[0m', '[WARN] You may now only use IDE at ' + origins + ' to connect to this instance');

require('../src/router');
